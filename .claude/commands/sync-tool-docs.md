# /sync-tool-docs Command

Synchronize tool documentation across README and VitePress.

## Usage

```
/sync-tool-docs <tool-name|all>
```

## Parameters

| Parameter | Required | Description | Example |
|-----------|----------|-------------|---------|
| tool-name-or-all | Yes | Tool name or `all` for all tools | `test-flakiness-detector` or `all` |

## Examples

```bash
# Sync specific tool
/sync-tool-docs test-flakiness-detector

# Sync all tools
/sync-tool-docs all
```

## What This Command Does

This command ensures documentation consistency between:
- Tool README.md (canonical source)
- VitePress docs (generated from README)
- Meta repo documentation references

### 1. Read Tool README.md

Extract key sections:
- Installation instructions
- CLI usage examples
- API reference
- Feature list
- Examples

### 2. Update VitePress Pages

**getting-started.md** ← Installation section
```markdown
## Installation

\`\`\`bash
git clone https://github.com/tuulbelt/{tool-name}.git
cd {tool-name}
npm install
\`\`\`
```

**cli-usage.md** ← CLI Usage section
```markdown
## Basic Usage

\`\`\`bash
{short-name} --help
{short-name} --flag value
\`\`\`
```

**library-usage.md** ← API Reference section
```typescript
import { SomeFunction } from '@tuulbelt/{tool-name}';
```

**examples.md** ← Examples section
All code examples from README

**api-reference.md** ← Function documentation
Detailed API from JSDoc/Rustdoc comments

### 3. Validate Consistency

Check for:
- Dead links (internal and external)
- Broken code examples
- Mismatched version numbers
- Outdated CLI flags
- Missing sections

### 4. Update Tool Counts

Update references across:
- `docs/index.md` - home page count
- `docs/tools/index.md` - tools page count
- `docs/guide/getting-started.md` - tool table
- `README.md` - status count

### 5. Report Changes

```
Synchronized test-flakiness-detector documentation:

Updated:
- docs/tools/test-flakiness-detector/getting-started.md (3 changes)
- docs/tools/test-flakiness-detector/cli-usage.md (1 change)
- docs/tools/test-flakiness-detector/examples.md (5 changes)

Warnings:
- Dead link: /tools/unknown-tool/ (removed)
- Outdated flag: --old-flag (updated to --new-flag)

No errors.
```

## Sync Modes

### Single Tool Mode

```bash
/sync-tool-docs test-flakiness-detector
```

Updates only the specified tool's VitePress docs from its README.

### All Tools Mode

```bash
/sync-tool-docs all
```

Iterates through all tools in `tools/` directory and syncs each one.

Use this after:
- Major documentation restructuring
- VitePress template changes
- Batch tool updates

## Quality Checks

The command performs these checks:

### Link Validation
```bash
# Check internal links
grep -r '\[.*\](/.*/)' docs/tools/{tool-name}/ | while read line; do
  # Verify target exists
done

# Check external links (optional, slow)
# curl -I {url} | grep "HTTP/1.1 200"
```

### Code Example Validation
```bash
# Extract code blocks
# Verify they're syntactically valid (lint check)
# Optional: Run examples to verify they work
```

### Version Consistency
```bash
# Check version in package.json
# Check version in README badges
# Check version in VitePress frontmatter
# Ensure all match
```

## What Gets Synchronized

| Source (README.md) | Target (VitePress) | Section |
|--------------------|-------------------|---------|
| Installation | getting-started.md | How to clone/install |
| CLI Usage | cli-usage.md | Command-line examples |
| Library Usage | library-usage.md | API imports and usage |
| Examples | examples.md | All code examples |
| API Reference | api-reference.md | Function documentation |
| Features | index.md | Feature list |

## What Doesn't Get Synchronized

These are maintained independently:

- Demo GIFs (generated by create-demos.yml)
- Troubleshooting sections (tool-specific)
- Architecture diagrams (manual)
- Performance benchmarks (manual)

## Sync Strategy

The command follows this logic:

```
For each section in README.md:
  1. Extract content
  2. Transform for VitePress (markdown adjustments)
  3. Check if VitePress version differs
  4. If different:
     - Compare semantic content (ignore whitespace)
     - If semantically different:
       - Update VitePress page
       - Log change
     - Else:
       - Skip (only formatting differs)
  5. Validate links and code
```

## Troubleshooting

### "Documentation mismatch detected"
```
WARNING: README.md and VitePress docs are out of sync for test-flakiness-detector.

README.md has:
- detectFlakiness(testFn, runs)

VitePress api-reference.md has:
- detectFlakiness(testFn)  # Missing 'runs' parameter

Recommendation:
1. Update VitePress: /sync-tool-docs test-flakiness-detector
2. Or update README if VitePress is correct
```

### "Dead link detected"
```
ERROR: Dead link in docs/tools/test-flakiness-detector/index.md:
  [Unknown Tool](/tools/unknown-tool/)

Fix:
1. Update link to correct path
2. Or remove link if tool doesn't exist
3. Retry sync: /sync-tool-docs test-flakiness-detector
```

### "Code example fails validation"
```
WARNING: Code example in examples.md has syntax errors:

\`\`\`typescript
const result = detectFlakiness(;  // Syntax error
\`\`\`

Fix:
1. Update README.md with correct syntax
2. Retry sync: /sync-tool-docs test-flakiness-detector
```

## Automation

This command can be run:

**Manually:**
```bash
/sync-tool-docs test-flakiness-detector
```

**After README changes:**
```bash
# In tool repository
git add README.md
git commit -m "docs: update usage examples"

# In meta repository
git submodule update --remote tools/test-flakiness-detector
/sync-tool-docs test-flakiness-detector
git commit -m "docs: sync test-flakiness-detector documentation"
```

**In CI (future):**
```yaml
# .github/workflows/sync-docs.yml
on:
  schedule:
    - cron: '0 0 * * 0'  # Weekly
  workflow_dispatch:

jobs:
  sync-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: claude-code '/sync-tool-docs all'
      - run: git commit -am "docs: sync all tool documentation"
      - run: git push
```

## Related Commands

- `/update-all-counts` - Update tool counts only
- `/new-tool` - Create new tool (auto-syncs initially)
- `/release-tool` - Release new version (may need re-sync)

## References

- VitePress Documentation: https://vitepress.dev/
- Markdown Links: https://www.markdownguide.org/basic-syntax/#links
- Quality Checklist: `docs/QUALITY_CHECKLIST.md`
