name: Update VitePress Tool Links

on:
  # Manual trigger only
  workflow_dispatch:

  # Run when submodules updated
  push:
    branches:
      - main
    paths:
      - 'tools/**'

jobs:
  update-links:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
          fetch-depth: 0

      - name: Update VitePress docs to link to tool READMEs
        run: |
          echo "Updating VitePress documentation links..."
          echo ""
          echo "NOTE: Demos are maintained ONLY in standalone tool repositories."
          echo "VitePress documentation links to tool READMEs for demo content."
          echo ""

          # Track if any changes were made
          CHANGES_MADE=false

          for tool_path in tools/*/; do
            tool_path=${tool_path%/}
            tool_name=$(basename "$tool_path")

            echo "→ $tool_name"

            # VitePress index.md should link to tool README demo section
            INDEX_FILE="docs/tools/$tool_name/index.md"

            if [ -f "$INDEX_FILE" ]; then
              # Ensure Demo section links to standalone repo README
              TOOL_README_URL="https://github.com/tuulbelt/$tool_name#demo"

              # Check if Demo section exists and update it
              if grep -q "## Demo" "$INDEX_FILE"; then
                echo "  ✓ Demo section found - VitePress links to tool README"
              else
                echo "  ⚠️  No Demo section in VitePress docs"
              fi
            fi

            echo ""
          done

          echo "✓ VitePress documentation structure verified"
          echo ""
          echo "Demos are generated and maintained in each tool's repository."
          echo "Users access demos via tool README links on GitHub."
